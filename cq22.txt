10 OPTION BASE 1
15 CALL CHARPAT(89,A$):: IF A$<>RPT$("F",16)THEN RUN "DSK1.CQUEST2"
20 DIM CL(9)
30 DIM PL$(8,3)
40 PL$(1,1)="1112113"
50 PL$(1,2)="6224367"
60 PL$(1,3)="575:54;"
70 PL$(2,1)="121212:"
80 PL$(2,2)="64;8<53"
90 PL$(2,3)="5114117"
100 PL$(3,1)="121212;"
110 PL$(3,2)="64<8;8<"
120 PL$(3,3)="5:05;5;"
130 PL$(4,1)="12212<0"
140 PL$(4,2)="678;8<0"
150 PL$(4,3)="5:5;5;0"
160 PL$(5,1)="1212;6;"
170 PL$(5,2)="08;819:"
180 PL$(5,3)="05;5;5;"
190 PL$(6,1)="136221:"
200 PL$(6,2)="678991;"
210 PL$(6,3)="517541<"
220 PL$(7,1)="121212;"
230 PL$(7,2)="08;8;8;"
240 PL$(7,3)="05;5;5:"
250 PL$(8,1)="12;06;0"
260 PL$(8,2)="642;81:"
270 PL$(8,3)="5;5141;"
970 R=12 :: C=16 :: PE=10
971 CALL VILLAGE
975 CALL MAP(R,C,PE,CL())
980 IF PE<1 THEN 2000
990 CALL GCHAR(R,C,QW)
1000 IF QW=89 THEN CALL CAVE(R,C,PE):: IF PE<1 THEN 2000 ELSE 975
1010 IF QW=90 THEN 971
1020 IF QW=64 THEN CALL PALACE((R),(C),PE,PL$(,),CL()):: IF PE<1 THEN 2000 ELSE 975
1999 STOP
2000 CALL DEAD
2005 CALL HCHAR(2,1,89,128):: CALL COLOR(1,16,2)
2010 DISPLAY AT(3,5):"CONTINUE";
2020 DISPLAY AT(4,5):"END";
2025 R=3
2030 CALL HCHAR(R,5,39):: CALL HCHAR(R,5,32)
2040 CALL KEY(1,K,S):: IF K=18 THEN 2100
2050 CALL JOYST(1,X,Y):: R=R-SGN(Y):: IF R<3 THEN R=4 ELSE IF R>4 THEN R=3
2060 GOTO 2030
2100 CALL CLEAR :: CALL COLOR(1,2,4):: IF R=3 THEN 970 ELSE END
10000 SUB MAP(R,C,PE,CL())
10010 IF PE<1 THEN SUBEXIT
10011 CALL DELSPRITE(ALL):: CALL MAGNIFY(1)
10020 DISPLAY AT(1,1)ERASE ALL:"((((h!!!!Xppppppppppppp!!@!!"
10030 DISPLAY AT(2,1):"(@((h!!!!!!!!!!!!!!!!!pp!Xpp"
10040 DISPLAY AT(3,1):"( (hh!!!!!!!!!!!!!!! hh`````"
10050 DISPLAY AT(4,1):"( (hh! ! @  ! ! ! ! hhhhpppp"
10060 DISPLAY AT(5,1):"( hhh !   !   !  ! !hhhhpppp"
10070 DISPLAY AT(6,1):"( hhh"" ! ""!""   ! ""  Yhhhp@pp"
10080 DISPLAY AT(7,1):"( hhh "" !  ""   ""    hhhhp Xp"
10090 DISPLAY AT(8,1):"``hhh  @  """"    ""   hhhhp pp"
10100 DISPLAY AT(9,1):"  hhh""  "" """""" """""" "" hhh@pppp"
10110 DISPLAY AT(10,1):"hYhh     """""""" """"""""  hhh pppp"
10120 DISPLAY AT(11,1):"hhhh(((   """"   """"  hhhh pppp"
10130 DISPLAY AT(12,1):"hhh(((((     Z     hhhY Xppp"
10140 DISPLAY AT(13,1):"hhY((((( """"""   """"  hhhh pppp"
10150 DISPLAY AT(14,1):"hh(((     """""" """""" "" hhh pppp"
10160 DISPLAY AT(15,1):"hh((( ((  """""" """"""""  hhhhpppp"
10170 DISPLAY AT(16,1):"h(((( (( """"""   """""" ""hhhhhppp"
10180 DISPLAY AT(17,1):"((((( @(  ""     ""  hhhhhhhpp"
10190 DISPLAY AT(18,1):"((((((((""   ""  "" "" hhhhhhhhp"
10200 DISPLAY AT(19,1):"((((((((   ""      hhhhhhhhhh"
10210 DISPLAY AT(20,1):"(   (((( ""        hhhh( @(hh"
10220 DISPLAY AT(21,1):"( @ (((      (( ((((((( ((hh"
10230 DISPLAY AT(22,1):"(   ((((((( (((@((((((( ((hh"
10240 DISPLAY AT(23,1):"((((((((((((((((((((((( (((h"
10250 DISPLAY AT(24,1):"(((((((((((((((((((((   (((("
10251 FOR A=1 TO 8 :: IF CL(A)=0 THEN 10260
10252 NEXT A :: CALL HCHAR(8,3,32,2):: IF CL(9)=0 THEN 10260
10253 CALL HCHAR(3,26,112,5)
10260 CALL SPRITE(#3,35,6,(R-1)*8+1,(C-1)*8+1,#2,37,10,1,27*8+1)
10265 LR=INT(RND*24)+1 :: LC=INT(RND*28)+3
10266 CALL GCHAR(LR,LC,QW):: IF QW<>33 AND QW<>34 AND QW<>40 AND QW<>112 THEN 10265
10270 CALL JOYST(1,X,Y)
10271 CALL KEY(1,K,S):: IF K=18 THEN CALL UPDATE(PE,CL()):: GOTO 10010
10280 IF X=0 AND Y=0 THEN 10270
10290 R=R-SGN(Y):: C=C+SGN(X)
10300 IF R<1 OR R>24 THEN R=-(R<1)-24*(R>24)
10310 IF C<3 OR C>30 THEN C=-3*(C<3)-30*(C>30)
10320 CALL GCHAR(R,C,QW)
10330 IF QW=104 OR QW=112 OR QW=96 THEN R=R+SGN(Y):: C=C-SGN(X):: GOTO 10270
10340 CALL LOCATE(#3,(R-1)*8+1,(C-1)*8+1)
10345 IF R<>LR OR C<>LC THEN 10350
10347 X=INT(RND*20)+1 :: FOR A=1 TO X :: CALL SOUND(1,1500,0):: PE=PE+1 :: NEXT A :: GOTO 10265
10350 IF QW=32 THEN 10270
10360 IF QW=64 OR QW=89 OR QW=90 THEN SUBEXIT
10370 IF QW=88 THEN 10500
10380 FOR A=1 TO 1-(QW=33)
10390 CALL POSITION(#2,T,V)
10400 T=(T-1)/8+1 :: V=(V-1)/8+1
10410 T=T+SGN(R-T):: V=V+SGN(C-V)
10420 CALL LOCATE(#2,(T-1)*8+1,(V-1)*8+1)
10430 IF T=R AND V=C THEN CALL FIGHT(QW,PE):: GOTO 10010
10440 NEXT A :: GOTO 10270
10500 C=C+1 :: CALL LOCATE(#3,(R-1)*8+1,(C-1)*8+1):: CALL SPRITE(#1,36,13,(R-1)*8+1,(C-1)*8+1)
10510 CALL JOYST(1,X,Y)
10520 IF X=0 AND Y=0 THEN 10510
10530 R=R-SGN(Y):: C=C+SGN(X)
10540 IF R<1 THEN R=1
10550 IF C>30 THEN C=30
10560 CALL GCHAR(R,C,QW)
10570 IF QW=88 THEN 10700
10580 IF QW<>112 THEN R=R+SGN(Y):: C=C-SGN(X):: GOTO 10510
10590 CALL LOCATE(#3,(R-1)*8+1,(C-1)*8+1,#1,(R-1)*8+1,(C-1)*8+1)
10600 GOTO 10510
10700 C=C-1 :: CALL DELSPRITE(#1):: CALL LOCATE(#3,(R-1)*8+1,(C-1)*8+1)
10710 GOTO 10270
10720 SUBEND
12000 SUB FIGHT(QW,PE)
12005 E=INT(RND*6)*5
12007 CALL CLEAR :: CALL DELSPRITE(ALL):: CALL MAGNIFY(2)
12010 IF QW=40 THEN 12600 ELSE IF QW=34 THEN 12300
12030 CALL HCHAR(12,1,91,12*32)
12031 CALL HCHAR(1,1,89,64)
12035 CALL SPRITE(#9,62,2,200,50,-10,1,#10,63,2,200,200,10,1)
12040 CALL SPRITE(#1,92,6,73,128,#2,93,6,89,128,#3,107,6,77,128)
12050 CALL SPRITE(#4,60,2,100,200,#5,61,2,116,200)
12060 FOR A=100 TO 73 STEP -1 :: CALL LOCATE(#4,A,200,#5,A+16,200):: NEXT A
12080 CALL MOVE(X)
12082 IF X=0 THEN 12100
12084 CALL COINC(#3,#4,16,Y):: IF Y=0 THEN 12100
12090 CALL COLOR(#4,16,#4,2):: CALL SOUND(100,-6,0):: E=E-5 :: IF E<1 THEN CALL DELSPRITE(#4,#5,#6):: V=INT(RND*10)+1 :: PE=PE+V :: DISPLAY AT(1,1):STR$(V)&"YPTS";
12100 CALL POSITION(#1,R,C,#4,T,V):: Y=SGN(C-V)
12110 CALL MOTION(#4,0,Y,#5,0,Y)
12120 CALL COINC(#4,#1,16,Y):: IF Y THEN CALL HIT(PE):: IF PE<1 THEN SUBEXIT
12121 CALL COINC(#9,#2,16,Y):: CALL COINC(#10,#1,16,C):: IF Y OR C THEN CALL HIT(PE):: IF PE<1 THEN SUBEXIT
12125 CALL POSITION(#1,R,C):: IF C<10 OR C>245 THEN SUBEXIT
12130 GOTO 12080
12300 CALL HCHAR(1,1,89,64):: CALL HCHAR(3,1,58,256):: FOR A=5 TO 25 STEP 5 :: CALL VCHAR(10,A,125,15):: NEXT A
12305 CALL COLOR(1,2,5)
12310 CALL HCHAR(24,1,58,32)
12320 CALL SPRITE(#1,92,6,153,128,#2,93,6,169,128,#3,107,6,157,128)
12330 CALL SPRITE(#4,42,16,1,200,#5,43,16,17,200):: FOR A=2 TO 153 :: CALL LOCATE(#4,A,200,#5,A+16,200):: NEXT A
12340 CALL SPRITE(#28,41,2,56,250)
12350 CALL MOVE(X):: IF X=0 THEN 12400
12355 CALL COINC(#3,#28,16,Y):: IF Y THEN CALL DELSPRITE(#28)
12360 CALL COINC(#3,#5,10,Y):: IF Y=0 THEN 12400
12365 CALL SOUND(100,-6,0)
12370 CALL COLOR(#5,2,#5,16):: E=E-5 :: IF E<0 THEN CALL DELSPRITE(#4,#5,#6):: V=INT(RND*10)+1 :: PE=PE+V :: DISPLAY AT(1,1):STR$(V)&"YPTS";
12400 CALL POSITION(#1,R,C):: IF C<10 OR C>245 THEN 12550
12405 CALL POSITION(#4,T,V):: Y=SGN(C-V):: CALL MOTION(#4,0,Y,#5,0,Y):: CALL PATTERN(#4,42-4*(Y=1),#5,43-4*(Y=1))
12410 CALL DISTANCE(#1,#4,A):: A=ABS(SQR(A)):: IF A>32 THEN 12500
12415 CALL MOTION(#4,0,0,#5,0,0)
12420 CALL POSITION(#1,R,C):: CALL POSITION(#4,T,V):: CALL PATTERN(#4,-44*(V>=C)-45*(V<C))
12425 CALL SPRITE(#6,59,16,T-16,V+3*(C>V)-4*(C<V))
12430 CALL MOVE(X)
12440 CALL PATTERN(#4,42-2*(V<C))
12450 CALL LOCATE(#6,T+5,V-16*(C>V)+16*(V>C)):: CALL PATTERN(#6,-108*(C>=V)-109*(C<V))
12460 CALL COINC(#6,#1,16,Y):: IF Y THEN CALL COINC(#6,#3,14,Y):: IF Y=0 THEN CALL HIT(PE):: IF PE<1 THEN 12550
12470 CALL DELSPRITE(#6)
12480 IF X THEN 12360
12500 CALL POSITION(#28,R,C):: IF R>170 THEN CALL MOTION(#28,-10,0):: GOTO 12350
12502 CALL COINC(#1,#28,16,Y):: IF Y THEN CALL HIT(PE):: IF PE<1 THEN 12550
12505 IF R>60 THEN 12350
12510 CALL POSITION(#1,T,V):: IF ABS(C-V)>8 THEN CALL MOTION(#28,0,5*SGN(V-C)):: GOTO 12350
12520 CALL MOTION(#28,10,0):: GOTO 12350
12550 CALL COLOR(1,2,4):: SUBEXIT
12600 CALL HCHAR(1,1,89,64):: CALL HCHAR(3,1,127,672):: CALL HCHAR(23,1,120,32)
12610 CALL SPRITE(#1,92,6,153,100,#2,93,6,168,100)
12620 CALL SPRITE(#3,107,6,157,100)
12630 CALL SPRITE(#4,124,16,136,200,#5,122,16,152,200,#6,122,16,168,200)
12640 CALL SPRITE(#28,38,14,168,1,-1,-5)
12650 CALL MOVE(X)
12655 IF X THEN CALL COINC(#3,#28,16,Y):: IF Y THEN CALL DELSPRITE(#28)
12660 IF X THEN CALL COINC(#3,#5,25,Y):: IF Y THEN 12800
12670 CALL POSITION(#1,R,C):: IF C<10 OR C>245 THEN SUBEXIT
12680 CALL POSITION(#28,R,C):: IF R<140 THEN CALL MOTION(#28,1,-5)ELSE IF R>165 THEN CALL MOTION(#28,-1,-5)
12690 CALL COINC(#1,#28,16,Y):: CALL COINC(#2,#28,16,Z):: IF Y OR Z THEN CALL HIT(PE):: IF PE<1 THEN SUBEXIT
12700 GOTO 12650
12800 CALL DELSPRITE(#6):: CALL LOCATE(#5,168,200,#4,152,200):: CALL PATTERN(#5,123)
12810 CALL MOTION(#4,0,-2,#5,0,-2)
12820 CALL MOVE(X):: IF X THEN CALL COINC(#3,#4,16,Y):: IF Y THEN CALL COLOR(#4,2,#4,16):: E=E-5 :: IF E<1 THEN CALL DELSPRITE(#4,#5)
12821 IF X AND Y THEN CALL SOUND(100,-6,0)
12825 IF X THEN CALL COINC(#3,#28,16,Y):: IF Y THEN CALL DELSPRITE(#28)
12830 IF E<1 THEN V=INT(RND*5)+1 :: DISPLAY AT(1,1):STR$(V)&"YPTS";:: PE=PE+V :: E=5
12840 CALL COINC(#1,#4,16,Y):: IF Y THEN CALL HIT(PE):: IF PE<1 THEN SUBEXIT
12850 CALL POSITION(#28,R,C):: IF R<140 THEN CALL MOTION(#28,1,5)ELSE IF R>165 THEN CALL MOTION(#28,-1,5)
12860 CALL COINC(#1,#28,16,Y):: CALL COINC(#2,#28,16,Z):: IF Y OR Z THEN CALL HIT(PE):: IF PE<1 THEN SUBEXIT
12870 CALL POSITION(#1,R,C):: IF C<10 OR C>245 THEN SUBEXIT
12880 GOTO 12820
12999 SUBEND
13000 SUB MOVE(X)
13001 IF X=0 THEN 13005
13003 CALL POSITION(#1,R,C):: CALL POSITION(#3,T,V):: V=V+1 :: CALL LOCATE(#3,T,C):: CALL PATTERN(#3,-107*(V>C)-95*(C>V))
13005 CALL KEY(1,K,S):: IF K=18 THEN 13100
13010 CALL JOYST(1,X,Y)
13020 IF X=0 AND Y=0 THEN SUBEXIT
13025 X=X*1.75
13030 CALL POSITION(#1,R,C)
13040 C=C+X :: CALL LOCATE(#1,R,C,#2,R+16,C):: CALL POSITION(#3,R,C):: CALL LOCATE(#3,R,C+X)
13045 IF X=7 THEN CALL PATTERN(#2,93,#3,107)ELSE IF X=-7 THEN CALL PATTERN(#2,94,#3,95)
13050 IF Y=0 THEN X=0 :: SUBEXIT
13060 Y=-16*(Y=-4)
13070 CALL POSITION(#1,R,C):: CALL LOCATE(#3,R+2+Y,C)
13080 X=0 :: SUBEXIT
13100 CALL POSITION(#4,R,C):: CALL POSITION(#1,T,V)
13110 CALL PATTERN(#3,-108*(C>V)-109*(C<V)-32*(C=V))
13111 CALL POSITION(#3,R,Y)
13112 @=V-16*(C>V)+16*(C<V):: IF @<1 THEN @=1 ELSE IF @>256 THEN @=256
13115 CALL LOCATE(#3,R,V-16*(C>V)+16*(C<V)+1)
13120 X=1 :: SUBEND
14000 SUB HIT(PE)
14005 CALL SOUND(100,-5,0)
14010 CALL COLOR(#1,16,#2,16,#1,2,#2,2,#1,6,#2,6)
14020 X=INT(RND*5)+1
14025 PE=PE-X :: DISPLAY AT(2,1):STR$(PE)&"YPTSYLEFTYY";
14030 SUBEND
15000 SUB UPDATE(PE,CL())
15005 CALL DELSPRITE(ALL)
15010 CALL HCHAR(3,3,96,28):: CALL HCHAR(21,3,96,28):: CALL VCHAR(3,3,96,18):: CALL VCHAR(3,30,96,18)
15020 FOR A=4 TO 20 :: CALL HCHAR(A,4,89,26):: NEXT A
15025 CALL COLOR(1,16,2)
15030 DISPLAY AT(5,3):"LIFEY"&STR$(PE);
15040 DISPLAY AT(6,3):"FINISHEDYPALACES";
15050 FOR A=1 TO 8 :: DISPLAY AT(A+7,4):STR$(A);:: IF CL(A)THEN DISPLAY AT(A+7,6):"'";
15060 NEXT A
15070 DISPLAY AT(18,5):"SAVE";
15080 DISPLAY AT(19,5):"RESTORE";
15090 DISPLAY AT(20,5):"CONTINUE";
15095 R=20
15100 CALL HCHAR(R,5,39):: CALL HCHAR(R,5,32):: CALL KEY(1,K,S):: CALL JOYST(1,X,Y):: R=R-SGN(Y):: IF R<18 THEN R=20
15110 IF R>20 THEN R=18
15120 IF K<>18 THEN 15100
15130 IF R=20 THEN CALL COLOR(1,2,4):: SUBEXIT
15140 IF R=18 THEN 15500
15150 OPEN #1:"DSK1.CQ2SAVE",INPUT ,DISPLAY ,FIXED 64
15160 INPUT #1:PE
15170 FOR A=1 TO 9 :: INPUT #1:CL(A):: NEXT A :: CLOSE #1
15180 GOTO 15010
15500 OPEN #1:"DSK1.CQ2SAVE",OUTPUT,DISPLAY ,FIXED 64
15510 PRINT #1:PE
15520 FOR A=1 TO 9 :: PRINT #1:CL(A):: NEXT A :: CLOSE #1 :: GOTO 15010
15530 SUBEND
16000 SUB VILLAGE
16001 CALL SCREEN(5)
16005 CALL DELSPRITE(ALL):: CALL CHAR(116,"")
16007 CALL MAGNIFY(2):: CALL SPRITE(#4,65,1,1,128)
16008 CALL HCHAR(1,1,116,736)
16010 FOR A=1 TO 3 :: FOR B=0 TO 2 :: CALL VCHAR(21,A*7+B,115,3):: NEXT B :: CALL HCHAR(21,A*7,113):: CALL HCHAR(21,A*7+2,114)
16020 CALL HCHAR(22,A*7+1,110):: CALL HCHAR(23,A*7+1,111):: NEXT A
16025 CALL HCHAR(24,1,115,32):: CALL SPRITE(#1,92,6,153,100,#2,93,6,169,100)
16027 CALL SPRITE(#3,107,6,157,100)
16030 CALL MOVE(X)
16040 CALL POSITION(#1,R,C):: IF C<10 OR C>245 THEN SUBEXIT
16050 IF X=0 THEN 16030
16060 CALL DISTANCE(#1,169,57,A):: CALL DISTANCE(#1,169,112,B):: CALL DISTANCE(#1,169,169,C)
16065 CALL HCHAR(1,1,89,128)
16070 IF A<B AND A<C THEN 16100
16080 IF B<A AND B<C THEN 16200 ELSE 16300
16100 DISPLAY AT(1,1):"TAKEYALLYTHEYGEMSYANDYPLACEYTHEMYINYTHEYSTATUESYINYTHEYYPALACES";
16110 CALL KEY(1,K,S):: IF S=0 THEN 16110
16120 CALL HCHAR(1,1,116,128):: GOTO 16030
16200 DISPLAY AT(1,1):"WHENYALLYGEMSYAREYPLACEDYTHEMAGICYPALACEYOPENSYTOYGIVEYYTHEYPOWERYWANDYTOYDEFEATYTHEEVILYSORCERER";
16210 GOTO 16110
16300 DISPLAY AT(1,1):"SEARCHYTHEYMAPYFORYLIFEYYYYYPOWER";
16310 GOTO 16110
16320 SUBEND
17000 SUB DEAD
17001 CALL CLEAR
17005 CALL SCREEN(2)
17010 FOR A=1 TO 3 :: FOR B=1 TO 16 :: CALL COLOR(#1,B,#2,B,#3,B):: CALL SOUND(-100,1000-(A*17+B)*10,0):: NEXT B :: NEXT A
17020 CALL CLEAR :: CALL DELSPRITE(ALL):: CALL SCREEN(3)
17030 SUBEND
18000 SUB CAVE(R,C,PE)
18010 IF R=6 THEN RO=12 :: OC=C+3
18020 IF R=12 THEN RO=6 :: OC=C-3
18030 IF R=10 THEN RO=13 :: OC=C+2
18040 IF R=13 THEN RO=9 :: OC=C-1
18050 CALL CLEAR :: CALL DELSPRITE(ALL):: CALL MAGNIFY(2)
18060 X=RND
18070 CALL HCHAR(1,1,89,608):: CALL HCHAR(20,1,129,32):: CALL HCHAR(21,1,130,96)
18080 CALL SPRITE(#1,92,6,120,50,#2,93,6,136,50,#3,107,6,124,50)
18090 IF X>.7 THEN CALL SPRITE(#4,62,5,200,100,-10,1,#5,63,5,200,200,11,2):: GOTO 18120
18100 IF X>.4 THEN CALL SPRITE(#4,41,5,30,200):: GOTO 18120
18110 CALL SPRITE(#4,38,14,136,100,-5,5)
18120 CALL MOVE(_)
18125 IF X>.7 THEN 18140
18130 IF _ THEN CALL COINC(#3,#4,16,Y):: IF Y THEN DISPLAY AT(1,1):"Y1YPTS";:: PE=PE+1 :: CALL DELSPRITE(#4)
18140 CALL POSITION(#1,T,V):: IF V>245 THEN R=RO :: C=OC :: SUBEXIT
18150 IF V<10 THEN SUBEXIT
18160 IF X>.7 THEN 18300
18170 CALL COINC(#1,#4,14,Y):: CALL COINC(#2,#4,14,Z):: IF Y OR Z THEN CALL HIT(PE):: IF PE<1 THEN SUBEXIT
18180 IF X>.4 THEN 18250
18190 CALL POSITION(#4,T,V):: IF T<110 THEN CALL MOTION(#4,5,5)ELSE IF T>133 THEN CALL MOTION(#4,-5,5)
18200 GOTO 18120
18250 CALL POSITION(#1,T,V):: CALL POSITION(#4,Y,B)
18255 IF Y<40 AND ABS(V-B)<10 THEN CALL MOTION(#4,10,0):: GOTO 18120
18260 IF Y<40 THEN CALL MOTION(#4,0,5*SGN(V-B)):: GOTO 18120
18270 IF Y>130 THEN CALL MOTION(#4,-10,0)
18280 GOTO 18120
18300 CALL COINC(#1,#5,14,Y):: CALL COINC(#2,#4,14,Z):: IF Y OR Z THEN CALL HIT(PE):: IF PE<1 THEN SUBEXIT
18310 GOTO 18120
18320 SUBEND
19000 SUB PALACE(R,C,PE,PL$(,),CL())
19010 IF R=1 THEN 30000 ! WIZARD
19020 IF R=2 THEN IF CL(9)=0 THEN 29000 ELSE 19107
19030 IF R=4 THEN PN=1
19040 IF R=6 THEN PN=7
19050 IF R=8 THEN PN=2
19060 IF R=9 THEN PN=6
19070 IF R=17 THEN PN=3
19080 IF R=20 THEN PN=5
19090 IF R=21 THEN PN=8
19100 IF R=22 THEN PN=4
19105 IF CL(PN)=0 THEN 19110
19107 CALL HCHAR(1,1,89,32):: DISPLAY AT(1,1)BEEP:"THISYPALACEYISYCOMPLETE";:: FOR A=-1 TO 1 :: CALL KEY(1,K,S):: A=K :: NEXT A :: SUBEXIT
19110 CALL CLEAR :: CALL DELSPRITE(ALL)
19120 CALL HCHAR(1,1,89,32):: DISPLAY AT(1,1):"PALACEY"&STR$(PN);
19121 CALL MAGNIFY(2):: CALL SPRITE(#1,92,6,121,50,#2,93,6,137,50,#3,107,6,123,50)
19122 PRST=2
19125 PR=1 :: PC=1
19130 IF PR<>1 OR PC<>1 THEN CALL CLEAR
19131 CALL SPRITE(#4,65,1,100,128)
19132 N$=SEG$(PL$(PN,PR),PC,1)
19135 ON ASC(N$)-48 GOSUB 19500,19600,19700,19800,19900,20000,20100,20200,20300,20400,20800,20600
19140 CALL MOVE(X):: IF X THEN CALL COINC(#2,#4,16,Y):: IF Y THEN GOSUB 20700 :: GOTO 19130
19150 CALL POSITION(#1,R,C):: IF C<21 AND POS("712349",N$,1)<>0 THEN PC=PC-1 :: CALL LOCATE(#1,121,200,#2,137,200,#3,123,200):: IF PC=0 THEN SUBEXIT ELSE 19130
19155 IF C<21 THEN CALL LOCATE(#1,R,C+16,#2,R+16,C+16,#3,R+3,C+16)
19160 IF C>220 AND POS("1245689",N$,1)<>0 THEN PC=PC+1 :: CALL LOCATE(#1,121,50,#2,137,50,#3,123,50):: GOTO 19130
19165 IF C>220 THEN CALL LOCATE(#1,R,C-16,#2,R+16,C-16,#3,R+3,C-16)
19170 GOTO 19140
19500 CALL HCHAR(PRST,1,128,608):: PRST=1
19510 CALL HCHAR(20,1,129,32)
19520 CALL HCHAR(21,1,130,128)
19530 RETURN
19600 GOSUB 19500
19610 FOR A=15 TO 16 :: CALL VCHAR(2,A,128,23):: NEXT A
19620 CALL SPRITE(#4,97,2,148,113)
19630 RETURN
19700 GOSUB 19600 :: CALL VCHAR(2,30,131,18)
19710 RETURN
19800 GOSUB 19500 :: CALL SPRITE(#4,97,2,153,113):: RETURN
19900 GOSUB 19800 :: CALL VCHAR(2,3,131,18):: RETURN
20000 GOSUB 19600 :: CALL VCHAR(2,3,131,18):: RETURN
20100 GOSUB 19800 :: CALL VCHAR(2,30,131,18):: RETURN
20200 GOSUB 19600 :: CALL VCHAR(2,3,131,18):: RETURN
20300 GOSUB 19600 :: RETURN
20400 GOSUB 19500
20410 FOR A=11 TO 21 :: CALL VCHAR(10,A,141,10):: NEXT A
20420 FOR A=9 TO 23 :: CALL VCHAR(11,A,141,9):: NEXT A
20430 FOR A=7 TO 25 :: CALL VCHAR(12,A,141,8):: NEXT A
20440 FOR A=5 TO 27 :: CALL VCHAR(13,A,141,7):: NEXT A
20450 FOR A=14 TO 19 :: CALL HCHAR(A,5,141,23):: NEXT A
20460 CALL HCHAR(9,13,134):: CALL HCHAR(9,19,135)
20470 CALL HCHAR(12,14,138):: CALL HCHAR(12,18,138)
20480 CALL HCHAR(14,16,133):: CALL HCHAR(18,16,136)
20490 CALL POSITION(#1,R,C):: R=18 :: C=INT(C/8)+1
20500 FOR A=C TO 16 :: CALL GCHAR(R,A,QW):: CALL HCHAR(R,A,139):: IF QW<>136 THEN CALL HCHAR(R,A,QW)
20505 CALL SOUND(-300,-3,30-(A-1)*2):: FOR B=1 TO 50 :: NEXT B
20510 NEXT A
20512 CALL SOUND(50,-6,0)
20515 FOR A=1 TO INT(RND*15)+1
20520 CALL SOUND(-300,-5,0):: CALL SCREEN(16)
20530 CALL SOUND(-300,-7,15):: CALL SCREEN(3)
20535 NEXT A
20540 CALL HCHAR(12,14,132):: CALL HCHAR(12,18,132)
20550 CL(PN)=1 :: FOR A=1 TO 300 STEP 5 :: CALL SOUND(-10,A*10+110,A/10):: NEXT A
20551 CALL HCHAR(1,1,89,64)
20555 DISPLAY AT(1,1):"CONGRATULATIONSYYTHISYPALACEISYCOMPLETED";:: FOR A=-1 TO 1 :: CALL KEY(1,K,S):: A=K :: NEXT A
20560 FOR A=1 TO 16 :: CALL VCHAR(1,A,32,24):: CALL VCHAR(1,33-A,32,24):: FOR B=1 TO 10 :: NEXT B :: NEXT A
20570 SUBEXIT
20600 GOSUB 19700 :: CALL HCHAR(1,1,89,64):: DISPLAY AT(1,1):"AYROOMYOFYHEALING";
20610 A=INT(RND*10)+1 :: DISPLAY AT(2,1):"GETY"&STR$(A)&"YLIFEYPOINTS";
20620 CALL CHAR(116,"101878183C181412")
20625 CALL CHAR(117,"2812405529492814")
20630 CALL SPRITE(#4,116,12,200,112)
20640 CALL MOTION(#4,-25,0):: FOR A=1 TO 200 :: NEXT A
20650 FOR A=0 TO 2.2*PI STEP .4 :: CALL MOTION(#4,-20*SIN(A),20*COS(A)):: NEXT A
20660 CALL MOTION(#4,-8,-8):: CALL POSITION(#1,T,V)
20670 CALL POSITION(#4,R,C):: IF C<=V THEN CALL SPRITE(#5,117,16,R,C,5,ABS(C-V)/ABS(R-T))
20675 IF C>V THEN 20670
20680 CALL COINC(#1,#5,16,T):: IF T THEN 20690
20681 CALL POSITION(#4,R,C):: IF R<200 THEN 20680
20682 CALL DELSPRITE(#4):: GOTO 20680
20690 CALL DELSPRITE(#4,#5):: FOR B=2 TO A+2 :: CALL SOUND(100,550,0):: CALL COLOR(#1,B,#2,B,#3,B):: PE=PE+1 :: NEXT B
20691 CALL COLOR(#1,6,#2,6,#3,6):: CALL LOCATE(#1,121,10,#2,137,10,#3,124,10):: N$="1"
20692 X$=PL$(PN,PR):: X$=SEG$(X$,1,PC-1)&";" :: IF PC<>7 THEN X$=X$&SEG$(PL$(PN,PR),PC+1,7-PC)
20693 PL$(PN,PR)=X$ :: GOTO 19150
20700 CALL JOYST(1,A,Y):: IF Y=0 THEN RETURN
20710 IF Y=-4 AND POS("23689",N$,1)<>0 THEN 20730
20720 IF Y=4 AND POS("45789",N$,1)<>0 THEN 20730
20725 RETURN
20730 CALL MOTION(#1,-Y*3,0,#2,-Y*3,0,#3,-Y*3,0,#4,-Y*3,0)
20740 CALL POSITION(#1,R,C):: CALL POSITION(#4,T,V):: IF R<200 AND Y=4 THEN 20740 ELSE IF T<200 AND Y=-4 THEN 20740
20745 CALL MOTION(#1,0,0,#2,0,0,#3,0,0,#4,0,0):: CALL LOCATE(#1,121,128,#2,137,128,#3,124,129)
20750 PR=PR-SGN(Y):: RETURN
20800 GOSUB 19700 :: CALL HCHAR(1,1,89,64):: DISPLAY AT(1,1):"AYROOMYOFYDEATH";
20810 CALL CHAR(116,"0C700C000C700C00")
20820 CALL POSITION(#1,R,C):: CALL SPRITE(#27,116,2,R,256,#28,116,2,R+16,256)
20825 @=INT(RND*(PN*5))+PN*5
20830 CALL MOTION(#27,0,-@,#28,0,-@)
20840 CALL COINC(#1,#27,16,@)
20850 IF @ THEN 20880
20855 CALL MOVE(X@)
20860 CALL POSITION(#1,R,C):: IF C<21 THEN DISPLAY AT(2,1):"ESCAPED";:: GOTO 20899
20870 GOTO 20840
20880 CALL DELSPRITE(#27,#28)
20890 @=INT(RND*(PN*2))+1 :: DISPLAY AT(2,1):"LOSEY"&STR$(@)&"YLIFE";:: CALL SOUND(100,-6,0):: PE=PE-@ :: IF PE<1 THEN SUBEXIT
20895 CALL COLOR(#1,16,#2,16,#3,16)
20896 CALL COLOR(#1,2,#2,2,#3,2)
20897 CALL COLOR(#1,6,#2,6,#3,6)
20899 CALL DELSPRITE(#27,#28):: FOR @=-1 TO 1 :: CALL KEY(1,@,A):: NEXT @ :: CALL LOCATE(#1,121,10,#2,137,10,#3,124,10):: N$="1" :: GOTO 19150
29000 CALL CLEAR :: CALL DELSPRITE(ALL):: CALL MAGNIFY(2):: GOSUB 19500
29020 CALL HCHAR(6,12,141,9):: CALL HCHAR(7,12,141,9)
29030 CALL HCHAR(8,10,141,13):: CALL HCHAR(9,10,141,13)
29040 CALL HCHAR(10,8,141,17):: CALL HCHAR(11,8,141,17)
29050 FOR A=12 TO 19 :: CALL HCHAR(A,6,141,21):: NEXT A
29060 CALL HCHAR(5,15,134):: CALL HCHAR(5,17,135)
29070 CALL HCHAR(5,12,135):: CALL HCHAR(5,20,134)
29080 CALL HCHAR(7,10,135):: CALL HCHAR(7,22,134)
29090 CALL HCHAR(9,8,135):: CALL HCHAR(9,24,134)
29100 CALL HCHAR(11,6,135):: CALL HCHAR(11,26,134)
29110 FOR A=13 TO 19 STEP 3 :: CALL HCHAR(9,A,138):: CALL HCHAR(11,A,138):: NEXT A
29120 CALL HCHAR(13,15,133):: CALL HCHAR(13,17,133)
29130 CALL HCHAR(17,16,137)
29140 FOR A=30 TO 15 STEP -1 :: CALL SOUND(-100,-2,A):: NEXT A
29150 CALL HCHAR(17,16,140):: CALL SOUND(100,-6,0)
29160 FOR A=30 TO 0 STEP -1
29170 CALL SCREEN(2):: CALL SOUND(-100,-5,A)
29180 CALL SCREEN(15):: CALL SOUND(-100,-6,A)
29190 CALL SCREEN(3):: CALL SOUND(-100,-7,A)
29200 NEXT A
29210 FOR A=13 TO 19 STEP 3 :: CALL HCHAR(9,A,132):: CALL HCHAR(11,A,132):: NEXT A
29220 CALL CHAR(142,"102810101010101")
29230 CALL SPRITE(#1,142,10,1,128,5,0)
29240 C$=":979"
29245 A=1
29250 CALL COLOR(#1,ASC(SEG$(C$,A,1))-48):: A=A+1 :: IF A=5 THEN A=1
29260 CALL POSITION(#1,R,C):: IF R<135 THEN 29250
29270 CALL MOTION(#1,0,0):: CALL HCHAR(1,1,89,96):: DISPLAY AT(1,1):"THEYGEMYHASYRELEASEDYTHEYYYYPOWERYSTAFFYYGOYDISPOSEYOFYYTHEYSORCERER";
29280 CALL COLOR(#1,ASC(SEG$(C$,A,1))-48):: A=A+1 :: IF A=5 THEN A=1
29290 CALL KEY(1,K,S):: IF K<>18 THEN 29280
29300 CL(9)=1 :: SUBEXIT
30000 CALL DELSPRITE(ALL):: CALL HCHAR(1,1,89,768)
30002 DISPLAY AT(1,1)BEEP:"THEYPALACEYOFYTHEYSORCERERYYYYYYPLEASEYWAIT";
30005 CALL SOUND(1,550,30)
30007 A$=STR$(PE):: X=LEN(A$):: FOR A=1 TO 3-X :: A$="0"&A$ :: NEXT A :: CALL CHAR(33,A$)
30010 RUN "DSK1.CQ23"
32767 SUBEND
